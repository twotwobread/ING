코드의 중복을 줄이고 재사용성을 높이는 대표적인 방법이 상속이다

재사용의 관점에서 상속은 클래스 안에 정의된 인스턴스 변수와 메서드를 자동으로 새로운 클래스에 추가하는 구현기법이다.

상속외에도 객체지향에서 효과적으로 재사용할 수 있는 방법은 합성이다

# 상속과 중복 코드

### DRY 법칙

Dont Repeat Yourself, 중복된 코드를 작성하지 말라는 의미이다. 중복의 가장 큰 문제는 코드 수정 시 리소스를 몇 배는 더 증가시킨다는 것이다.

중복 여부를 판단하는 기준은 변경이다. 요구사항이 변경됐을 때 두 코드를 함께 수정해야 한다면 이 코드는 중복이다. 함께 수정할 필요가 없다면 중복이 아니다.

### 중복과 변경

중복 코드가 늘어날수록 변경에 취약해지고 버그가 발생할 확률이 높아진다. 중복 코드의 양이 많아질수록 버그의 수는 증가하며 그에 비례해 코드를 변경하는 속도는 점점 느려진다.

### 상속을 이용해서 중복 코드 제거하기

상속의 기본 아이디어는 이미 존재하는 클래스와 유사한 클래스가 필요하면 코드를 복사하지 말고 상속을 이용해서 코드를 재사용하라는 것이다. 하지만 상속을 이용하려면 상위 클래스에 세부적인 구현을 알아야 한다. 즉, 부모 클래스와 자식 클래스 사이에 강한 결합을 생성한다.

- 상속을 위한 경고 1
    - 자식 클래스 내부에서 super를 이용하여 상위 클래스 메서드 호출 시 강하게 결합된다.
    - super 호출을 제거할 수 있는 방법을 찾아 결합도를 제거해라.

자식클래스가 부모클래스의 구현에 강하게 결합될 경우 부모 클래스의 변경에 의해 자식 클래스가 영향을 받는다.

# 취약한 기반 클래스 문제

부모 클래스의 변경에 의해 자식 클래스가 영향을 받는 현상을 취약한 기반 클래스 문제라고 부른다.

상속은 자식 클래스를 점진적으로 추가해서 기능을 확장하는데는 용이하지만 높은 결합도로 인해 부모 클래스를 점진적으로 개선하는 것은 어렵게 만든다. 최악의 경우엔 모든 자식 클래스를 동시에 수정하고 테스트 해야할 수 있다.

상속 계층의 상위에 위치한 클래스에 가해지는 작은 변경만으로도 상속 계층에 속한 모든 자손들이 급격하게 요동칠 수 있다.

객체비향의 기반은 캡슐화를 통한 변경의 통제이다. 상속은 코드의 재사용을 위해 캡슐화의 장점을 희석시키고 구현에 대한 결합도를 높임으로써 객체지향이 가진 강력함을 반감시킨다.

### 불필요한 인터페이스 상속문제

자바 유틸의 stack, properties 클래스는 특정 클래스를 상속받은 자식 클래스들이다. 얘들은 불필요한 인터페이스를 상속받음으로써 자료구조상 동작할 수 없는 기능을 수행하게 된다. 물론 사용자가 이를 걸러서 사용하지 않으면 되겠지만 그럼 결국 세부적인 구현을 알아야 한다. 그리고 좋은 인터페이스 설계는 잘못된 사용을 하는것은 매우 어렵게 만들고 옳은 사용법은 쉽게 만드는 것이다. 그렇기에 단순히 코드 재사용성을 위한 상속은 매우 위험하다.

- 상속을 위한 경고 2
    - 상속받은 부모 클래스의 메서드가 자식 클래스의 내부 구조에 대한 규칙을 깨트릴 수 있다.

### 메서드 오버라이딩의 오작용 문제

메서드 오버라이딩의 실수로 원치 않은 동작을 만들어낼 수 있다. 이 문제는 상속에서 상위 클래스의 세부적 구현을 모르는 경우 발생할 수 있으며 예방하기 위해선 세부적 구현을 알아야 한다. 하지만 알아도 만약 상위 클래스의 세부 구현이 변경된다면 하위 클래스들도 바뀌어야 한다. 이를 해결하기 위해서 상속을 이용하면 세부 구현을 문서화하라고 얘기하는데 이는 캡슐화릉 깨뜨린다. 

상속은 코드 재사용을 위해 캡슐화를 희생한다. 완벽한 캡슐화를 원한다면 코드 재사용을 포기하거나 상속 이외의 다른 방법을 사용해야 한다.

- 상속을 위한 경고 3
    - 자식 클래스가 부모 클래스의 메서드를 오버라이딩할 경우 부모 클래스가 자신의 메서드를 사용하는 방법에 자식 클래스가 결합될 수 있다.

### 부모 클래스와 자식 클래스의 동시 수정 문제

자식 클래스가 부모 클래스의 메서드릉 오버라이딩 하거니 불필요한 인터페이스를 상속받지 않았음에도 부모 클래스 수정 시 자식 클래스다 함께 수정할 수 있다는 사실을 알아야 한다.

- 상속을 위한 경고 4
    - 클래스를 상속하면 결합도로 인해 자식 클래스와 부모 클래스의 구현을 영원히 변경하지 않거니 동시에 변경하고나 둘 중 하나를 선택할 수 밖에 없다.

# Phone 다시 살펴보기

취약한 기반 클래스 문제을 완전히 없앨 수는 없지만 어느 정도까지 위험을 완화시키는 것은 가능하다. 문제 해결의 열쇠는 추상화다.

### 추상화에 의존하자

부모 클래스와 자식 클래스 모두 추상화에 의존하도록 수정해야 한다.

### 차이를 메서드로 추출하자

가장 먼저 할 일은 중복 코드 내에서 차이점을 별도의 메서드로 추출하는 것이다. 변하는 것으로부터 변치 않는 것을 분리해라.

### 중복 코드를 부모 클래스로 올려라

메서드의 구현체들은 그대로 두고 중복된 공통 사항들만 부모 클래스로 올리자. 중복된 공통 사항은 추상 클래스에서 구현하고 다른 구현 사항은 자식 클래스에서 구현할 수 있게 protected로 시그니처만 써주고 자식 클래스에서 구현을 하면 부모 클래스, 자식 클래스 모두 추상화에 의존하게 된다.

### 추상화가 핵심이다.

공통 코드를 상위로 이동시킨 후엔 서로 다른 변경 이유를 가진다는 것에 주목하자.

상속 계층이 코드를 진화시키는 데 걸림돌이 된다면 추상화를 찾고 상속 계층 안의 클래스들이 그 추상화에 의존하도록 코드를 리팩토링하자.

상속은 코드 재사용과 관련된 대부분의 경우에 우아한 해결 방법이 아니다. 객체지향에 능숙한 개발자들은 상속의 단점을 피하면서도 코드를 재사용할 수 있는 더 좋은 방법을 알고 있는데 이는 합성이다.
